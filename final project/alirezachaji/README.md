# image-processing-class
image processing class - 992

## Information
* ##### Teacher: Dr. Farzin Yaghmaee - [Contact](mailto:f_yaghmaee@semnan.ac.ir)
* ##### TA : Amir Shokri - [Contact](mailto:amirshokri@semnan.ac.ir)

### Student Info :
* Full name : Alireza Chaji
* github id : alirezachaji
* Email : alirezachaji@protonmail.com
* Type : Shabaneh
***
***

<div dir="rtl">
 
#### تمرین نهایی
#### برنامه تمرین شماره ۱۹ که توسط جناب آقای شکری حل گردیده است را بهبود داده آن را در تابع های مختلف تقسیم بندی کنید و در نهایت ۱۵۰ تصویر با برنامه بهبود داده شده تهیه کرده و میزان تشخیص برنامه OCR متلب را روی این تصاویر بررسی کنید.
. <br />
***
### توضیحات کلی برنامه:
در این برنامه جدای از مبحث تقسیم بندی برنامه به قسمت های مختلف سعی شده است تصاویر تولیدی به گونه ای باشند که تشخیص برای برنامه OCR متلب سخت باشد برای اینکار تصاویر کاراکترها به مقدار زاویه ای رندم دوران داده شده همچنین نویز فلفل نمکی نیز روی این تصاویر اعمال شده است و قسمتی از تصاویر به صورت نگاتیو در آورده شده و همچنین از کیفیت کارکترهای ورودی نیز کاسته شده است
برای تولید ۱۵۰ تصویر از حلقه تکرار ۱۵۰ تایی استفاده شده در هر حلقه کلیه عملیات فوق روی هر تصویر اعمال شده و از کاربر نیز درخواست میکند حدس خود از کارکترهای هر تصویر را که مشاهده می کند تایپ کند و در نهایت برنامه اطلاعات این ۱۵۰ تصویر را در آرایه ای ذخیره کرده و به فایل اکسل منتقل می کند مشاهده می گردد که در ۱۵۰ تصویر تولید شده دقت تشخیص برای متلب برابر صفر درصد و برای اینجانب ۸۷ درصد بوده است. همچنین در این برنامه برای ۱۵۰ کپچای تولیدی ابعاد تصویر و تعداد کاراکتر تصویر نیز به صورت رندم  در نظر گرفته شده است در بخش های بعد به توضیح جزئیات برنامه می پردازیم..
 
### توضیحات بخش های برنامه
***

 این قسمت باعث بسته شدن تمام پنجره ها ، ریست شدن تمام متغیر ها و پاک شدن کامند ویندو می گردد <br />
</div>

``` matlab

close all;         
clear all;         
clc;    

```
***
<div dir="rtl">

در این بخش ابتدا آرایه جهت ذخیره اطلاعات ۱۵۰ تصویر تولیدی و همچین متغیرهایی جهت معیار تشخیص درست کاربر و تابع OCR متلب تعریف گردیده است .

</div>

``` matlab
g=cell(150,7);
correct_ocr=0;
correct_guess=0;
g(1,:)={'Item','Captcha','Image','OCR','Correctness_OCR','Guess','Correctness_guess'};
 
```

***
<div dir="rtl">

در این بخش از برنامه قسمتی از حلقه تکرار ۱۵۰ تایی آورده شده است ابتدا تعداد کاراکتر ها به صورتی عددی رندم بین ۳ تا ۶ مشخص گردیده است سپس ابعاد تصویر نیر به صورت رندم تعریف می گردند. در ادامه برنامه توسط تابع main_func تصویر کپچا تولید شده و به همراه تکست کاراکترهای کپچا به برنامه اصلی باز گردانده می شود و در ادامه اطلاعات آن تصویر از جمله شماره - کد کپچا - ماتریس تصویر - خروجی تابع OCR متلب از این تصویر در آرایه ذخیره می گردد و سپس توسط دستورات شرطی درستی تشخیص تابع OCR متلب بررسی و نتیجه در آرایه ذخیره می گردد .

</div>

``` matlab
for i=1:150
    n=randi([3,6]);
    height=randi([100,400]);
    width=randi([400,n*150]);
    [pic,code]=main_func(n,height,width);
    g(i+1,1)={i};
    g(i+1,2)={code};
    g(i+1,3)={pic};
    d=ocr(pic);
    ocr_out=d.Text;
    g(i+1,4)={ocr_out};
    sc=size(code);
    so=size(ocr_out);
    if (sc(2)==so(2))
        if(ocr_out==char(code))
            correct_ocr=correct_ocr+1;
            g(i+1,5)={1};
        else
            g(i+1,5)={0};
        end  
    else
        g(i+1,5)={0};
    end
 
```

***
<div dir="rtl">

در این بخش از برنامه ادامه بخش های حلقه تکرار آورده شده است که در آن ابتدا از کاربر درخواست می کند حدس خود از تصویر کپچایی که توسط تابع main_func ایجاد شده را تایپ کند و این حدس را در ارایه ذخیره می کند سپس درستی حدس کاربر توسط دستورات شرطی با کارکترهای اصلی مقایسه گردیده و نتیجه تشخیص در آرایه ذخیره می گردد در انتهای حلقه تکرار نیز تصویر کپچای تولیدی با نام شماره تصویر در مسیر جاری با فرمت PNG ذخیره می گردد. در قسمت پایانی برنامه نیز کل اطلاعات موجود در ارایه در فایل اکسل به نام Result.xlsx ذخیره می گردد
</div>

``` matlab
    a=input("Enter The Captcha Letters no "+num2str(i)+": ",'s');
    g(i+1,6)={a};
    so=size(a);
    if (sc(2)==so(2))
        if(a==char(code))
            correct_guess=correct_guess+1;
            g(i+1,7)={1};
        else
            g(i+1,7)={0};
        end  
    else
        g(i+1,5)={0};
    end
    imwrite(pic,num2str(i)+".png");
end 
xlswrite('Result.xlsx',g);
```
***
#### توضیحات توابع استفاده شده در برنامه

***
### main_func :

<div dir="rtl">
این تابع وظیفه تولید تصویر کپچا در هر حلقه تکرار برنامه اصلی را برعهده دارد که خود این تابع نیز تعدادی تابع دیگر را در دل خود جای داده که در ادامه به توضیح آن می پردازیم . این تابع تعداد کاراکتر و ابعاد تصویر را به عنوان ورودی از تابع اصلی دریافت کرده  سپس توسط تابع get_ch ماتریسی شامل تصاویر هر یک از کارکترهای مورد نیاز آن تصویر کپچا و همچنین تکست آن کپچا را تولید می کند .

</div>


``` matlab
function [pic,code]=main_func(n,height,width)

%% parameters defining
[alphabet,code]=get_ch(n);
pic=zeros(height,width);
```
***


<div dir="rtl">
 
در ادامه توسط تابع join_char تصویری که حاصل از به هم چسباندن کلیه کارکتر هاست را تولید می کند و در ادامه بخشی از این تصویر که به صورت رندم انتخاب می گردد   توسط تابع rand_inv به نگاتیو تبدیل می شود بدینصورت که بخش های سیاه سفید شده و بخش های سفید سیاه می شود و در نهایت توسط تابع pepper_noise  میزان ۳۰ درصد نویز فلفل نمکی به تصویر اضافه می گردد. البته امکان اینکه میزان درصد نویز نیز رندم باشد وجود داشت که به همین میزان ۳۰ درصد اکتفا گردیده است . پس از اعمال نویز تصویر نهایی نمایش داده می شود. 

</div>

``` matlab
%% Joing random chars in a single image
pic=join_char(pic,alphabet,height,width,n);
% figure('Name',code);
% imshow(pic);

%% Invert a random part of the image
pic=rand_inv(pic,height,width);
% figure('Name',code);
% imshow(pic);

%% Add some salt & pepper noise to be more hard to read by OCR
pic=pepper_noise(pic,30);
%figure('Name',code);
imshow(pic);


end
```
***
### get_ch :

<div dir="rtl">

این تابع تعداد کاراکتر را از تابع اصلی دریافت کرده سپس دو ماتریس جهت ذخیره تصاویر کاراکترها و همچنین کد تکست آن کاراکتر ایجاد می کند در ادامه توسط حلقه تکرار به میزان تعداد کاراکتر از آدرس محل کارکترهای تمرین شماره ۱۹ هر کاراکتر را برداشته و درون ماتریس ذخیره میکند و در نهایت ماتریس شامل تمام کارکتر ها و همچنین کد تکست آن را به تابع main_func برمی گرداند. نکته قابل ذکر اینکه کاراکتر ها در این تابع به صورت رندم بین حروف بزرگ الفبای انگلیسی انتخاب می شوند. 

</div>

``` matlab

function [alphabet,text]=get_ch(n)
alphabet=zeros(25,25,n);
code=zeros(1,n);
i=1;
    for i=1:n
       s='A':'Z';
       str=s(randi(numel(s))); 
       add="..\..\..\excersiecs\arman-ariamehr\19\alphabet\"+str+".txt";
       code(i)=str;
       ch_arr=dlmread(add);
       alphabet(:,:,i)=ch_arr; 
       i=i+1;
    end  
    alphabet = uint8(alphabet);
    text=char(code);
    

```
***
### join_char :

<div dir="rtl">

این تابع پارامترهایی از قبیل تصویر خام تولیدی در مرحله قبل - ماتریس کاراکترها - طول و عرض تصویر و همچنین تعداد کارکترهای تصویر کپچا را به عنوان ورودی دریافت می کند  و سپس توسط حلقه تکرار هر کارکتر را توسط تابع captcha_rotate به اندازه مقداری تصادفی بین ۰ تا ۲۷۰ درجه دوران می دهد سپس توسط حلقه های تکرار تو در تو این تصاویر کارکترها را کنار هم می چسباند و در نهایت تصویر تولیدی را به تابع قبل باز می گرداند  

</div>

``` matlab
function pic=join_char(pic,alphabet,height,width,n)
for i=1:n
   r=randi(270);
   m=size(imbinarize(captcha_rotate(alphabet(:,:,i),r)));
   mm=zeros(m(1),m(2));
   mm=imbinarize(captcha_rotate(alphabet(:,:,i),r));
   mm=imresize(mm,[floor(height) floor(width/n)]);
   h=size(mm);
   for j=1:h(1)
       for k=1:h(2)
           c=(i-1)*h(2)+k;
           pic(j,c)=mm(j,k);         
       end
   end
end  
end

```
***
### captcha_rotate :

<div dir="rtl">
 
 رهای تصویر کپچا را به عنوان ورودی دریافت می کند  و سپس توسط حلقه تکرار هر کارکتر را توسط تابع captcha_rotate به اندازه مقداری تصادفی بین ۰ تا ۲۷۰ درجه دوران می دهد سپس توسط حلقه های تکرار تو در تو این تصاویر کارکترها را کنار هم می چسباند و در نهایت تصویر تولیدی را به تابع قبل باز می گرداند  

</div>
